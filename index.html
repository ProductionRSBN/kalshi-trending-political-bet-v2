<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=546, initial-scale=1.0">
    <title>Kalshi Live Bet Selector</title>
    <style>
        body {
            width: 546px;
            height: 658px;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #FFFFFF; /* Background Primary */
            font-family: Arial, sans-serif;
            color: #000000E6; /* Text primary */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        .header {
            width: 100%;
            background-color: #003221; /* Brand secondary */
            color: #FFFFFF;
            text-align: center;
            padding: 10px 0;
            font-size: 18px;
            font-weight: bold;
        }
        .logo {
            width: 150px;
            margin: 10px 0;
        }
        .promo {
            font-size: 16px;
            color: #09C285; /* Brand primary */
            margin: 10px 0;
            text-align: center;
        }
        #marketSelect {
            width: 80%;
            padding: 10px;
            margin: 20px 0;
            border: 1px solid #0000004D; /* Text tertiary */
            background-color: #FFFFFFF5; /* Background Secondary */
            font-size: 14px;
        }
        .display {
            width: 80%;
            background-color: #FFFFFF;
            border: 1px solid #00000080; /* Text secondary */
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .price-box {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .yes {
            color: #265CFF; /* Predict Yes */
            font-weight: bold;
            font-size: 24px;
        }
        .no {
            color: #AA00FF; /* Predict No */
            font-weight: bold;
            font-size: 24px;
        }
        .detail {
            font-size: 14px;
            color: #00000080; /* Text secondary */
            margin: 5px 0;
        }
        .footer {
            margin-top: auto;
            font-size: 12px;
            color: #0000004D; /* Text tertiary */
            text-align: center;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="header">Sponsored by Kalshi</div>
    <img src="https://upload.wikimedia.org/wikipedia/commons/e/ee/Kalshi_logo.svg" alt="Kalshi Logo" class="logo">
    <div class="promo">Trade on Kalshi – Predict the Future Today!</div>
    <select id="marketSelect">
        <option value="">Select a Live Trading Bet...</option>
    </select>
    <div class="display" id="display">
        <div id="title" class="detail">No bet selected</div>
        <div class="price-box">
            <div>Yes: <span id="yesPrice" class="yes">--</span>¢</div>
            <div>No: <span id="noPrice" class="no">--</span>¢</div>
        </div>
        <div class="detail">Last Price: <span id="lastPrice">--</span>¢</div>
        <div class="detail">Volume: <span id="volume">--</span></div>
        <div class="detail">Open Interest: <span id="openInterest">--</span></div>
    </div>
    <div class="footer">Live data from Kalshi API • Updates every 10s</div>

    <script>
        const baseUrl = 'https://api.elections.kalshi.com/trade-api/v2'; // Public API base (handles all markets despite 'elections')
        let updateInterval = null;

        async function fetchAllOpenMarkets() {
            let markets = [];
            let cursor = null;
            do {
                const params = new URLSearchParams({ status: 'open', limit: '500' });
                if (cursor) params.append('cursor', cursor);
                const response = await fetch(`${baseUrl}/markets?${params}`);
                if (!response.ok) throw new Error('Failed to fetch markets');
                const data = await response.json();
                markets = markets.concat(data.markets);
                cursor = data.cursor;
            } while (cursor);
            return markets;
        }

        async function populateSelect() {
            try {
                const markets = await fetchAllOpenMarkets();
                const select = document.getElementById('marketSelect');
                markets.forEach(market => {
                    const option = document.createElement('option');
                    option.value = market.ticker;
                    option.textContent = `${market.title} (${market.ticker})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching markets:', error);
                document.getElementById('title').textContent = 'Error loading markets';
            }
        }

        async function updateMarketData(ticker) {
            try {
                const response = await fetch(`${baseUrl}/markets/${ticker}`);
                if (!response.ok) throw new Error('Failed to fetch market data');
                const data = await response.json();
                const market = data.market;
                document.getElementById('title').textContent = market.title;
                document.getElementById('yesPrice').textContent = (market.yes_bid + market.yes_ask) / 2;
                document.getElementById('noPrice').textContent = (market.no_bid + market.no_ask) / 2;
                document.getElementById('lastPrice').textContent = market.last_price;
                document.getElementById('volume').textContent = market.volume;
                document.getElementById('openInterest').textContent = market.open_interest;
            } catch (error) {
                console.error('Error updating data:', error);
                document.getElementById('title').textContent = 'Error updating data';
            }
        }

        document.getElementById('marketSelect').addEventListener('change', (event) => {
            const ticker = event.target.value;
            if (!ticker) return;
            if (updateInterval) clearInterval(updateInterval);
            updateMarketData(ticker); // Initial update
            updateInterval = setInterval(() => updateMarketData(ticker), 10000); // Auto-update every 10s
        });

        // Load markets on page load
        populateSelect();
    </script>
</body>
</html>